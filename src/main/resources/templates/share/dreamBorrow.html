<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Title</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap-responsive.css">
    <style>


        .dream .row > div{
            height: 150px;
        }

        .dream {
            border: none !important;
            width:100%;
            height: 150px;
        }

        .rentGroup{
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #3B5C9A;
            color: #FFFFFF;
            text-align: center;
            font-size: 20px;
            font-weight: bolder;
        }

        .giveGroup{
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #FFB83D;
            color: #FFFFFF;
            text-align: center;
            font-size: 20px;
            font-weight: bolder;
        }


        .img-area,
        .item-info-area{
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #F5F5F5;
        }

        .select-area{
            display: flex;

        }

        .card-body p span{
            margin-right: 1em;
            width: 10em !important;
        }

        .card-body,
        .btn-group{
            display: flex;
            flex-direction: column;
            justify-content: center;

        }

        .status-area{
            background-color: #F5F5F5;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;

        }

        .status-select-area{
            display:flex;
            align-items: center;
            justify-content: flex-end;
            font-size: 16px;

        }

        .catSelect{
            width: 11em !important;
            margin-right: 20px;

        }

        .stat-select{
            width:8em !important;

        }


        .btn-area{
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #F5F5F5;

        }

        .btn-group{
            width: 100%;
        }

        .btns-1,
        .btns-2{
            display:flex;
            justify-content: space-between;
        }

        .page-link{
            background-color: #3B5C9A !important;
            border-color: #3B5C9A !important;
            color: #FFFFFF !important;
        }

        .pageActive{
            background-color: #0B1D40 !important;
            border-color: #0B1D40 !important;
            color: #FFFFFF !important;
        }

        .page-link:active,
        .page-link:focus{
            background-color: #0B1D40 !important;
            border-color: #0B1D40 !important;
            color: #FFFFFF !important;
        }

        .star_rating {
          width: 100%;
          box-sizing: border-box;
          display: inline-flex;
          float: left;
          flex-direction: row;
          justify-content: center;
        }
        .star_rating .star {
          width: 30px;
          height: 30px;
          margin-right: 10px;
          display: inline-block;
          background: url('/img/emptystar.png') no-repeat;
          background-size: 100%;
          box-sizing: border-box;
        }
        .star_rating .star.on {
          width: 30px;
          height: 30px;
          margin-right: 10px;
          display: inline-block;
          background: url('/img/star.png') no-repeat;
          background-size: 100%;
          box-sizing: border-box;
        }

        .star_box {
          width: 400px;
          box-sizing: border-box;
          display: inline-block;
          margin: 15px 0;
          background: #F3F4F8;
          border: 0;
          border-radius: 10px;
          height: 100px;
          resize: none;
          padding: 15px;
          font-size: 13px;
          font-family: sans-serif;
        }
        .btn02 {
          display:block;
          width: 400px;
          font-weight: bold;
          border: 0;
          border-radius: 10px;
          max-height: 50px;
          padding: 15px 0;
          font-size: 1.1em;
          text-align: center;
          background:bisque;
        }

    </style>
</head>
<body id="dreamBorrow">
<div th:replace="~{/common/menubar}"></div>
<div th:replace="~{share/dreamMenubar :: #dreamMenubar}"></div>

<div class="container">
    <h2 class="my-3" style="text-align:center; font-weight:bolder;">ë‚˜ì˜ ìš”ì²­ë“œë¦¼ ëª©ë¡</h2>

    <div class="select-area mb-1 mt-3 ms-1">
        <div class="col-3">
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="group" id="inlineRadio1"
                       value="" checked onchange="getBorrowList()">
                <label class="form-check-label" for="inlineRadio1">ëª¨ë‘</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="group" id="inlineRadio2"
                       value="rent" onchange="getBorrowList()">
                <label class="form-check-label" for="inlineRadio2">ëŒ€ì—¬</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="group" id="inlineRadio3"
                       value="give" onchange="getBorrowList()">
                <label class="form-check-label" for="inlineRadio3">ë‚˜ëˆ”</label>
            </div>
        </div>

        <div class="status-select-area col-9">
            <select th:fragment="catSelect" id="catSelect" class="form-select catSelect" name="itemCatCode"
                    onchange="getBorrowList()">
                <option value="">== ì¹´í…Œê³ ë¦¬ ì„ íƒ ==</option>
                <th:block th:if="${catList} != null">
                    <option th:each="cat:${catList}" th:value=${cat.catCode} th:text="${cat.catName}"></option>
                </th:block>
            </select>
            <label for="statusSelect" style="width:2em">
                ìƒíƒœ
            </label>
            <select class="form-select stat-select me-3" id=statusSelect name="statusSelect" onchange="getBorrowList()">
                <option value="">== ì „ì²´ ==</option>
                <option value="RQD">ì‹ ì²­ì™„ë£Œ</option>
                <option value="RNT">ëŒ€ì—¬ì¤‘</option>
                <option value="RTR">ë°˜ë‚©ì™„ë£Œ</option>
                <option value="REV">í‰ê°€ì™„ë£Œ</option>
                <option value="WIN">ë‹¹ì²¨</option>
                <option value="LST">ë‚™ì²¨</option>
            </select>

            <input class="form-control me-2" type="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”." id="keyword" style="width:13em">
            <button class="btn btn-udh-blue searchBtn" type="button" onclick="getBorrowList()">ê²€ìƒ‰</button>

        </div>

    </div>

    <div th:replace="~{/share/rentMain :: #spinner}"></div>

    <div th:fragment="reqDreams" id="reqDreams">
        <th:block th:if="${#lists.isEmpty(borrowList)}">
            <div class="alert alert-secondary" role="alert" style="width:100%; text-align:center">
                ë“±ë¡ëœ ë¬¼ê±´ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
        </th:block>
        <th:block th:unless="${#lists.isEmpty(borrowList)}">
            <div th:each="req : ${borrowList}" class=" mb-3 dream">
                <div class="row g-0">
                    <div th:classappend="${req.itemDTO.itemGroup == 'rent' ? 'rentGroup' : 'giveGroup'}" class="col-1">
                        [[${req.itemDTO.itemGroup == 'rent' ? 'ëŒ€ì—¬' : 'ë‚˜ëˆ”'}]]
                    </div>
                    <div th:onclick="|location.href='@{/share/{itemGroup}/detail(itemNo=${req.itemDTO.itemNo}, itemGroup=${req.itemDTO.itemGroup})}'|"
                         class="col-2 img-area">
                        <img th:src="${req.itemDTO.img == null ? '/img/noimg.jpg' : '/shaUploadFiles/' + req.itemDTO.img}"
                             class="img-fluid " alt="ë¬¼ê±´ì´ë¯¸ì§€" style="height:140px; cursor:pointer;">
                    </div>
                    <div class="col-4 item-info-area "
                         th:onclick="|location.href='@{/share/{itemGroup}/detail(itemNo=${req.itemDTO.itemNo}, itemGroup=${req.itemDTO.itemGroup})}'|"
                         style="cursor:pointer;">
                        <div class="card-body p-3">
                            <span class="badge text-bg-secondary mb-1" style="width:max-content">[[${req.itemDTO.itemCatName}]]</span>
                            <h4 class="mb-3">[[${req.itemDTO.title}]]</h4>
                            <p><span>ğŸ’›   [[${req.itemDTO.likeCnt}]]</span> <span>ğŸ‘€   [[${req.itemDTO.viewCnt}]]</span>
                                <span>ğŸ™‹â€â™€ï¸   [[${req.itemDTO.reqCnt}]]</span></p>
                            <p style="margin-bottom: 0">
                                <span>[[${req.itemDTO.locName}]]</span> <span id="modifiedAt">[[${req.itemDTO.displayDate}]]</span>
                            </p>
                        </div>
                    </div>
                    <div class="col-3 status-area">
                        <h5 th:if="${req.statusCode == 'WIN'}" class="align-middle" style="margin:0;">&#127882;[[${req.statusName}]]&#127882;</h5>
                        <h5 th:unless="${req.statusCode == 'WIN'}" class="align-middle" style="margin:0">[[${req.statusName}]]</h5>
                        <div class="align-middle" style="margin:0; font-size:0.8em;">[[${#temporals.format(req.modifiedAt, 'yyyy.MM.dd
                            HH:mm')}]]
                        </div>
                        <div th:if="${req.statusCode == 'RQD' && req.returnDate != null}">ë°˜ë‚©í¬ë§ì¼: [[${req.returnDate}]]
                        </div>
                        <div th:if="${req.statusCode == 'RNT'}">ë°˜ë‚©ì˜ˆì •ì¼: [[${req.returnDate}]]</div>
                    </div>
                    <div class="col-2 btn-area container">

                        <div th:if="${req.statusCode == 'RQD'}" class="btn-group">
                            <div class="mb-3 btns-1">
                                <button th:onclick="toggleCancelModal([[${req}]])"
                                        class="btn btn-udh-silver col-12" >ì‹ ì²­ì·¨ì†Œ
                                </button>

                            </div>
                            <div class="btns-2 ">
                                <button class="btn btn-udh-yellow col-12" >ìª½ì§€í•˜ê¸°</button>
                            </div>
                        </div>

                        <div th:if="${req.statusCode == 'RNT'}" class="btn-group">
                            <div class="mb-3 btns-1">
                                <button th:onclick="toggleReportModalBorrow([[${req}]])" class="btn btn-udh-red col-12">ë¬¼ê±´ì‹ ê³ 
                                </button>
                            </div>
                            <div class="btns-2">
                                <button class="btn btn-udh-yellow col-12">ìª½ì§€í•˜ê¸°</button>
                            </div>
                        </div>

                        <div th:if="${req.statusCode == 'RTR'}" class="btn-group">
                            <div class="btns-1">
                                <button th:onclick="toggleEvalModal([[${req}]])"
                                        class="btn btn-udh-silver col-12">í‰ê°€í•˜ê¸°
                                </button>

                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <nav class="row mt-3" th:if="${pageInfo} != null">
                <ul th:if="${pageInfo.totalCounts > 0}" class="pagination pagination-sm justify-content-center ">
                    <li class="page-item me-1" th:style="${pageInfo.currentPage == 1 ? 'visibility:hidden' : ''}">
                        <button th:onclick="getBorrowList([[${pageInfo.currentPage-1}]])" class="page-link btn-udh-blue "
                                aria-label="Previous">
                            <span>&laquo;</span>
                        </button>
                    </li>
                    <li th:each="page : ${#numbers.sequence(pageInfo.startPage, pageInfo.endPage)}"
                        class="page-item active me-1" aria-current="page">
                        <button th:text="${page}" class="page-link btn-udh-blue"
                                th:onclick="getBorrowList([[${page}]])"
                                th:classappend="${pageInfo.currentPage == page ? 'pageActive' : ''}"></button>
                    </li>
                    <li th:style="${pageInfo.currentPage == pageInfo.totalPage ? 'visibility:hidden' : ''}"
                        class="page-item me-1">
                        <button class="page-link btn-udh-blue " aria-label="Previous"
                                th:onclick="getBorrowList([[${pageInfo.currentPage+1}]])">
                            <span>&raquo;</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </th:block>

        <div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel"
             aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">ì •ë§ ì‹ ì²­ì„ ì·¨ì†Œí• ê¹Œìš”?</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>ì‹ ì²­ì„ ì·¨ì†Œí•˜ë©´ í•´ë‹¹ ë¬¼ê±´ì˜ ëŒ€ì—¬ ë° ë‚˜ëˆ”ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-udh-silver" data-bs-dismiss="modal">ì´ì „</button>
                        <button type="button" class="btn btn-udh-red" id="cancelReqBtn">ì‹ ì²­ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="evalModal" tabindex="-1" aria-labelledby="evalModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="evalModalLabel">ì´ì›ƒì„ í‰ê°€í•´ì£¼ì„¸ìš”. </h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center">
                        <span id="lenderName"></span>ë‹˜ì˜ ë§¤ë„ˆë¥¼ í‰ê°€í•´ ì£¼ì„¸ìš”.
                        <div class="star_rating mt-3">
                            <input type="hidden" id="score">
                            <span class="star on" data-value="1"> </span>
                            <span class="star on" data-value="2"> </span>
                            <span class="star on" data-value="3"> </span>
                            <span class="star on" data-value="4"> </span>
                            <span class="star on" data-value="5"> </span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                        <button type="button" class="btn btn-primary" id="evalBtn">í™•ì¸</button>
                    </div>
                </div>
            </div>
        </div>



        <div class="modal fade" id="reportModal" tabindex="-1"
             aria-labelledby="reportModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="reportModalLabel">ì‹ ê³ í•˜ê¸°</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="reportForm">
                            <div class="mb-3 row">
                                <label for="itemTitle" class="col-sm-2 col-form-label">ë¬¼ê±´:</label>
                                <div class="col-sm-10">
                                    <input type="text" readonly class="form-control-plaintext" id="itemTitle">
                                    <input type="hidden" name="reportedNo">
                                    <input type="hidden" name="typeCode">
                                    <input type="hidden" name="itemNo">
                                </div>


                            </div>
                            <div class="mb-3 row">
                                <label for="reporterMember" class="col-sm-2 col-form-label">ì‹ ê³ ì¸:</label>
                                <div class="col-sm-10">
                                    <input type="text" readonly class="form-control-plaintext"
                                           id="reporterMember">
                                    <input type="hidden" name="reporterMember">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label for="reportedMember" class="col-sm-2 col-form-label">ì‹ ê³ ëŒ€ìƒ:</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control-plaintext"
                                           id="reportedMember"
                                           readonly >
                                    <input type="hidden" name="reportedMember">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label for="reasonDetail" class="col-sm-2 col-form-label">ì‹ ê³ ë‚´ìš©:</label>
                                <div class="col-sm-10 p-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="reasonType"
                                               id="exampleRadios1" value="ë¯¸ì „ë‹¬" checked>
                                        <label class="form-check-label" for="exampleRadios1">
                                            ë¬¼ê±´ì„ ì „ë‹¬ë°›ì§€ ëª»í–ˆì–´ìš”.
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="reasonType"
                                               id="exampleRadios2" value="ë°›ì€ë¬¼ê±´ì´ìƒ">
                                        <label class="form-check-label" for="exampleRadios2">
                                            ëŒ€ì—¬ ë° ë‚˜ëˆ”ë°›ì€ ë¬¼ê±´ì˜ ìƒíƒœê°€ ì´ìƒí•´ìš”.
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="reasonType"
                                               id="exampleRadios3" value="ê¸°íƒ€">
                                        <label class="form-check-label" for="exampleRadios3">
                                            ê¸°íƒ€
                                        </label>
                                    </div>
                                    <textarea name="reasonDetail" class="form-control" id="reasonDetail" rows="3"
                                              placeholder="ì´ì›ƒê³¼ ë‚˜ëˆˆ ìª½ì§€ ë‚´ìš©ì´ë‚˜ ë¬¼ê±´ì˜ ìƒíƒœ ë“±ì„ ì ì–´ì£¼ì„¸ìš”."></textarea>
                                </div>

                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-udh-silver" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                        <button type="button" class="btn btn-udh-red" id="reportBtn">ì‹ ê³ </button>
                    </div>
                </div>
            </div>
        </div>

    </div>


</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.js"></script>
<script type="text/javascript" th:src="@{/js/sha.js}"></script>
</body>
</html>